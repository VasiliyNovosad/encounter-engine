<% levels_count = @levels.count %>
<h1>Статистика гри "<%= link_to @game.name, game_path(@game) %>"</h1>

<table id="stats" border="1">
  <thead>
    <tr align="center">
      <th></th>
      <% @levels.each do |level| %>
        <th>
          <%= "#{level.position}: #{level.name}" %>
        </th>
      <% end %>
      <th>Фінішний час</th>
      <th>Результат</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @teams.count.times do |pos| %>
      <tr valign="top">
        <td align="center" valign="middle"><%= pos + 1 %></td>
        <% @levels.each do |level| %>
          <% log = @level_logs[level.position - 1][pos] %>
          <td align="center">
            <% unless log[:log].nil? %>
                <p class="team-name"><%= log[:log].team %></p>
                <p>(<%= log[:log].user.nickname %>)</p>
                <p><%= log[:log].time.strftime('%d.%m.%Y') %></p>
                <p><%= log[:log].time.strftime('%H:%M:%S.%L') %></p>
                <% unless log[:result].nil? %>
                  <p>(<%= log[:result].strftime('%H:%M:%S.%L') %>)</p>
                <% end %>
                <% if log[:log].answer == 'timeout' %>
                    <p class="timeout-stat">таймаут</p>
                <% end %>
            <% end %>
          </td>
        <% end %>
        <% log = @level_logs[levels_count][pos] %>
        <!--{ team: result.team, levels: result.closed_levels.count, bonuses: result.sum_bonuses, time: result.finished_at || result.current_level_entered_at }-->
        <td align="center">
          <p class="team-name"><%= log[:team].name %>(<%= log[:levels] %>)</p>
          <p><%= log[:time].strftime('%d.%m.%Y') %></p>
          <p><%= log[:time].strftime('%H:%M:%S.%L') %></p>
          <% if log[:bonuses] > 0 %>
              <p><%= "Бонус: #{seconds_to_string(log[:bonuses])}" %></p>
          <% end %>
        </td>
        <% log1 = @level_logs[levels_count + 1][pos] %>
        <td align="center">
          <p class="team-name"><%= log1[:team].name %>(<%= log1[:levels] %>)</p>
          <p><%= log1[:time].strftime('%d.%m.%Y') %></p>
          <p><%= log1[:time].strftime('%H:%M:%S.%L') %></p>
        </td>
        <td align="center" valign="middle"><%= pos + 1 %></td>
      </tr>
    <% end %>
  </tbody>
</table>
