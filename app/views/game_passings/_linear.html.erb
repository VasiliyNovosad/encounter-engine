<%= link_to "Оновити", url_for("/play/#{@game.id}") %>
<br>
<br>

<fieldset>
  <legend>
    <%= @game_passing.current_level.name %>
  </legend>

  <%= form_tag("/play/#{@game.id}", method: "post") do %>
    <br>Код:
    <%= text_field_tag(:answer, nil, autofocus: true) %>
    <%= submit_tag " надіслати " %>
    <hr>
  <% end %>
  <br>

  <% if (@entered_all_answers.count > 0) && answer_posted? %>
    <% if answer_was_correct? %>
      <div>
        Код <font color="236400"><b><%= @answer %></b></font> вірний.<br><hr>
      </div>
    <% else %>
      <p>
        Код <font color="ae0011"><b><%= @answer %></b></font> невірний.<br><hr>
      </p>
    <% end %>

    <p id="entered_codes">
        <br>Введено коди:
      <%= @entered_all_answers.join ', '  %><hr>
    </p>

  <% end %>

  <%= @game_passing.current_level.team_task(@team_id).html_safe %>

  <% if @game_passing.current_level.questions.count > 1 %>
    <div>
      <br>
      <b>Вірних кодів <%= @game_passing.answered_questions.size %> із <%= @game_passing.current_level.team_questions(@team_id).count %>:<!--<br /><font color="236400"><%#= "#{@entered_correct_answers.sort!.join '<br>'}".html_safe  %>--></b></font>
      <hr>
      <hr>
    </div>
  <% end %>

  <%= render @game_passing.current_level.olymp? ? 'olymp' : 'multy' %>
  <hr>
  <br>
  <%= render 'bonuses' %>

  <br>

  <div id="LevelHintsContainer">
    <% hints_count = @game_passing.hints_to_show(@team_id).count + @game_passing.upcoming_hints(@team_id).count %>
    <% @game_passing.hints_to_show(@team_id).each_with_index do |hint, index| %>
      <fieldset>
        <legend>
          Підказка <%= index + 1 %> із <%= hints_count %>
        </legend>
        <%= hint.text.html_safe %>
      </fieldset>
      <br>
    <% end %>
  </div>

  <!--
  <% unless @game_passing.upcoming_hints(@team_id).empty?  %>
      <div id="<%= "LevelHintCountdownContainer#{@game_passing.upcoming_hints(@team_id).first.id}" %>">До наступної підказки <span id="<%= "LevelHintCountdownTimerText#{@game_passing.upcoming_hints(@team_id).first.id}" %>">3 хвилини</span></div>
      <div id="<%= "LevelHintCountdownLoadIndicator#{@game_passing.upcoming_hints(@team_id).first.id}" %>" style="display: none;">Завантаження...</div>

      <script>
          LevelHintUpdater().setup({
              initialCountdownValue: <%= @game_passing.upcoming_hints(@team_id).first.available_in(@game_passing.current_level_entered_at) %>
              ,gameId: <%= @game_passing.game_id %>, teamId: <%= @team_id %>, hintId: <%= @game_passing.upcoming_hints(@team_id).first.id %>
          })
      </script>
  <% else %>
      <div>
        Підказок більше не буде
      </div>
  <% end %>
  -->

  <% @game_passing.upcoming_hints(@team_id).each_with_index do |hint, index|  %>
      <div id="<%= "LevelHintCountdownContainer#{hint.id}" %>" class="hint-timer">До підказки <%= @game_passing.hints_to_show(@team_id).count + index + 1 %> лишилось <span id="<%= "LevelHintCountdownTimerText#{hint.id}" %>">3 хвилини</span></div>
      <div id="<%= "LevelHintCountdownLoadIndicator#{hint.id}" %>" style="display: none;">Завантаження...</div>
      <br>
      <script>
          LevelHintUpdater.setup({
              initialCountdownValue: <%= hint.available_in(@game_passing.current_level_entered_at) %>
              ,gameId: <%= @game_passing.game_id %>, teamId: <%= @team_id %>, hintId: <%= hint.id %>, hintNum: <%= index %>
          })
      </script>
  <% end %>

  <br>

  <% if @game_passing.current_level.complete_later > 0 %>
    <div id="LevelCompleteCountdownContainer" >До завершення рівня <span id="LevelCompleteCountdownTimerText">3 хвилини</span></div>

    <script>
      LevelCompleter.setup({
        initialCountdownValue: <%= (@game_passing.current_level_entered_at - Time.zone.now.strftime("%d.%m.%Y %H:%M:%S").to_time).to_i + @game_passing.current_level.complete_later %>
        ,gameId: <%= @game_passing.game_id %>, levelId: <%= @game_passing.current_level.id %>
      })
    </script>
  <% end %>
</fieldset>


