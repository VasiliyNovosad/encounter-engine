<h2>
  –ì—Ä–∞ "<span class="coming-game"><%= @game.name %></span>"
</h2>

<% if @game.draft? %>
  <div class="is-draft-message">–ß–æ—Ä–Ω–æ–≤–∏–∫</div>
<% end %>


<p>
  <em>–ê–≤—Ç–æ—Ä–∏</em> - <strong><%= (@game.authors.map(&:nickname) + [@game.author.nickname]).uniq.join(', ') %></strong>
</p>

<% if user_signed_in? && (current_user.author_of?(@game) || @game.author_finished?) %>
  <p>
    <em>–°—Ü–µ–Ω–∞—Äi–π:</em> <strong><%=link_to '–¥–æ—Å—Ç—É–ø–Ω–∏–π', show_scenario_game_path(@game) %></strong>
  </p>
<% end %>

<p>
  <% if @game.starts_at.nil? %>
    –î–∞—Ç–∞ –ø–æ—á–∞—Ç–∫—É –≥—Ä–∏ —â–µ –Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∞
  <%  else  %>
    <em>–ü–æ—á–∞—Ç–æ–∫ –≥—Ä–∏</em>: <%=  (@game.is_testing? ? @game.test_date : @game.starts_at).strftime('%H:%M %d.%m.%Y')  %>
  <%  end %>
</p>
<p>
  <% if @game.registration_deadline.nil? %>
    –ö—ñ–Ω—Ü–µ–≤–∏–π —Ç–µ—Ä–º—ñ–Ω —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó —â–µ –Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ
  <%  else  %>
    <em>–ö—ñ–Ω—Ü–µ–≤–∏–π —Ç–µ—Ä–º—ñ–Ω —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó</em>: <%=  @game.registration_deadline.strftime('%H:%M %d.%m.%Y')  %>
  <%  end %>
</p>

<p>
  <em>–¢–∏–ø –≥—Ä–∏:</em> <%= @game.game_size || '–õ–∞–π—Ç' %>
</p>

<p>
  <em>–ü–æ—Å–ªi–¥–æ–≤–Ωi—Å—Ç—å –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è:</em> <%= @game.game_type == 'linear' ? ' –õi–Ωi–π–Ω–∞' : @game.game_type == 'panic' ? ' –®—Ç—É—Ä–º' : ' –õ—ñ–Ω—ñ–π–Ω–∞ (–≤–∫–∞–∑–∞–Ω–∞)' %>
</p>

<% if @game.game_type == 'panic' %>
  <p>
    <em>–¢—Ä–∏–≤–∞–ªi—Å—Ç—å –≥—Ä–∏:</em> <%= " #{@game.duration} —Ö–≤–∏–ª–∏–Ω" %>
  </p>
<% end %>

<p>
  <em>–í–Ω–µ—Å–æ–∫ –∑–∞ —É—á–∞—Å—Ç—å:</em> <%= " #{@game.price} –≥—Ä–Ω" %>
</p>
<p>
  <em>–ú—ñ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è:</em> <%= " #{@game.city}" %>
</p>
<p>
  <em>–ú—ñ—Å—Ü–µ —Å—Ç–∞—Ä—Ç—É:</em> <%= " #{@game.place}" %>
</p>

<% unless @topic.nil? %>
  <p>
    <em>–û–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è:</em> <%= link_to " #{@topic.posts.count} –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å", forem.forum_topic_path(@topic.forum, @topic) %>
  </p>
<% end %>

<% if current_user&.captain? %>
    <p><% game_entry = GameEntry.of(current_user.team, @game)%>
      <%= render 'shared/game_entry_controls', game_entry: game_entry, game: @game, team: current_user.team %></p>
<% end %>
<br>

<p>
  <em>–û–ø–∏—Å:</em>
</p>
<p>
  <%= @game.description.html_safe %>
</p>

<p>
  <em>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–æ–º–∞–Ω–¥:</em>
</p>
<p>
  <% if @game.max_team_number.equal?(10000) || @game.max_team_number.equal?(0) || @game.max_team_number.nil? %>
    –ù–µ–æ–±–º–µ–∂–µ–Ω–æ
    <% @game.max_team_number = 10000 %>
  <% else %>
    <%= @game.max_team_number %>
  <% end %>
</p>

<br>

<% if user_signed_in? && current_user.author_of?(@game) %>

  <fieldset>
    <legend>
      –ó–∞–≤–¥–∞–Ω–Ω—è:
    </legend>

    <p>
      <%= render 'levels/list', levels: @game.levels  %>
    </p>

    <p>
      <%= link_to "–î–æ–¥–∞—Ç–∏ –Ω–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è", new_game_level_path(@game) %>
    </p>
  </fieldset>
  <br>
<% end %>      

<%= render 'game_entries', game_entries: @game_entries  %>
<br>
<%= render 'teams', accepted_game_entries: @accepted_game_entries, game: @game %>
<br>

<% if user_signed_in? && current_user.author_of?(@game) %>
  <p>
    <%= link_to "–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –¥–∞–Ω—É –≥—Ä—É", edit_game_path(@game) %>
  </p>
  <br>
<% end %>

<% if @game.game_type == 'selected' && @teams_for_test.count > 0 %>
  <p><%= link_to '–ó–∞–¥–∞—Ç–∏ –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è', url_for("/games/#{@game.id}/new_level_order") %></p>
<% end %>
<br>
<% if user_signed_in? %>
  <% if (@game.is_testing? ? @game.test_date : @game.starts_at) <= Time.zone.now.strftime("%d.%m.%Y %H:%M:%S.%L").to_time && !@game.author_finished? %>
    <div id="playButton"><%= link_to "–í—Ö—ñ–¥ —É –≥—Ä—É", url_for("/play/#{@game.id}") %></div>
  <% else %>
    <div id="playButton" style="display: none;"><%= link_to "–í—Ö—ñ–¥ —É –≥—Ä—É", url_for("/play/#{@game.id}") %></div>
  <% end %>
<% end %>
<br>
<p class="stat-link"><em><%= link_to "(—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)", url_for("/logs/short/#{@game.id}") if @game.started? && !@game.is_testing? %></em></p>
<br>
<%= render 'shared/countdown' %>
<div id="start-countdown"></div>
<br>

<script type="text/javascript">
  <% unless @game.starts_at.nil? %>
    var seconds_to_game = <%= ((@game.is_testing? ? @game.test_date : @game.starts_at) - Time.zone.now.strftime("%d.%m.%Y %H:%M:%S.%L").to_time + 1) %>;
    var dateObj = Date.now();
    dateObj += 1000 * seconds_to_game;
    var date = new Date(dateObj);
  <% end %>

  $("#start-countdown").countdown(date, {
    prefix:'–î–æ –ø–æ—á–∞—Ç–∫—É –ª–∏—à–∏–ª–æ—Å—å: '
  });
</script>

<% if user_signed_in? && current_user.author_of?(@game) && !@game.started?&& !@game.is_testing? && @game.levels && @game.levels.count > 0 %>

    <% if game_with_personal? || @game.game_type == 'selected' %>
        <%= form_tag "/games/start_test/#{@game.id}", method: 'get' do %>
            <%= label_tag "–ü–æ—á–∞—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è –∫–æ–º–∞–Ω–¥–∏" %>
            <%= select_tag(:team_id, options_for_select(@teams_for_test.map{ |team| [team.name, team.id] })) %>
            <%= submit_tag "–°—Ç–∞—Ä—Ç" %>
        <% end %>
    <% else %>
        <%= link_to '–ü–æ—á–∞—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è', url_for("/games/start_test/#{@game.id}") %>
    <% end %>

<% end %>

<% if user_signed_in? && current_user.author_of?(@game) && @game.is_testing? %>
   <%= link_to "–°—Ç–∞—Ä—Ç", url_for("/play/#{@game.id}") %>
   <br>
   <%= link_to "–ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è", url_for("/games/finish_test/#{@game.id}") %>
<% end %>

<% if user_signed_in? && current_user.author_of?(@game) %>
  <br>
  <br>
  <br>
  <br>
  <%= link_to "–ó–ê–í–ï–†–®–ò–¢–ò –ì–†–£", url_for("/games/end_game/#{@game.id}"), data: { confirm: '–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ?' } if (@game.started? && !@game.is_testing? && !@game.author_finished?) %>
  <br>
  <%= "–í–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏ –≥—Ä—É" if (@game.started? && !@game.is_testing? && @game.author_finished?) %>
  <br>
  <br>
  <br>
  <p>
    <%= link_to "–í–∏–¥–∞–ª–∏—Ç–∏ –¥–∞–Ω—É –≥—Ä—É", @game, method: :delete, data: { confirm: '–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ?' } %>
  </p>
<% end %>

<script type="application/ld+json">
  {
  "@context":"http://schema.org",
  "@type":"BreadcrumbList",
  "itemListElement":[
    {
      "@type":"ListItem",
      "position":1,
      "name":"Quest.wtf"
      },
    {
      "@type":"ListItem",
      "position":2,
      "name":"QL üîç "
      },
    {
      "@type":"ListItem",
      "position":3,
      "item":{
        "@id":"<%= game_url(@game) %>",
        "name":"<%= @game.name %>"
        }
      }
    ]
  }
</script>
<script type="application/ld+json">
  <% images = get_images(@game.description) %>
  {
  "@context":"http://schema.org",
  "@type":"Event",
  "name":"<%= @game.name %>",
  "description":"<%= @game.small_description || @game.name %>",
  <% if !@game.image.nil? || (images.length > 0) %>
      "image": "<%= @game.image || images[0] %>",
  <% end %>
  "performer": {
    "@type":"Person",
    "name":"<%= @game.author.nickname %>",
    "sameAs":"https://t.me/<%= @game.author.telegram || 'questwtf' %>"
    },
  "startDate":"<%= @game.starts_at %>",
  "endDate":"2018",
  "location":{
    "@type":"Place",
    "name":"<%= @game.place && @game.place != '' ? @game.place : '–¶–µ–Ω—Ç—Ä, –±—ñ–ª—è –ë—ñ–º-–ë–æ–º–∞' %>",
    "address":{
      "@type":"PostalAddress",
      "addressLocality":"<%= @game.city && @game.city != '' ? @game.city : '–õ—É—Ü—å–∫' %>"
      }
    },
  "offers": {
    "@type":"Offer",
    "url":"<%= game_url(@game) %>",
    "price":"<%= @game.price || 100 %>",
    "priceCurrency":"UAH",
    "availability":"http://schema.org/InStock",
    "validFrom":"2018"
    }
  }
</script>
